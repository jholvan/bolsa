<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Instituto Mix — Campo Largo | Solicite sua Bolsa de Desconto</title>
<link rel="icon" type="image/png" href="favicon.png">
  <meta name="description" content="Solicite seu cupom de até 35% de desconto para cursos no Instituto Mix Campo Largo. Preencha seus dados e garanta sua bolsa!"/>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #a3161d;
      --primary-dark: #831016;
      --primary-light: #d33b43;
      --bg: #fff;
      --text: #222;
      --border: #ddd;
      --success: #28a745;
      --error: #e53935;
      --badge: #a3161d;
      --badge-text: #fff;
      --wa: #25D366;
      --focus: #ffcccb;
      --radius: 8px;
      --gap: 1.5rem;
      --shadow: 0 2px 14px 0 rgba(0,0,0,0.07);
    }
    html { box-sizing: border-box; }
    *, *:before, *:after { box-sizing: inherit; }
    body {
      font-family: 'Inter', Arial, Helvetica, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      line-height: 1.55;
      font-size: 1.05rem;
      -webkit-font-smoothing: antialiased;
    }
    header {
      background: var(--primary);
      color: #fff;
      padding: 1.2rem 0 1rem 0;
      text-align: center;
      box-shadow: 0 2px 10px 0 rgba(163,22,29,0.05);
    }
    header h1 {
      margin: 0 0 0.2rem 0;
      font-size: 1.65rem;
      font-weight: 700;
      letter-spacing: -0.01em;
    }
    header p {
      margin: 0;
      font-size: 1.05rem;
      font-weight: 400;
      opacity: 0.97;
    }
    main {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      justify-content: center;
      margin: 0 auto;
      max-width: 950px;
      padding: 2.2rem 1rem 1.5rem 1rem;
      gap: var(--gap);
    }
    .info {
      flex: 1 1 320px;
      margin-right: var(--gap);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      min-width: 260px;
      max-width: 360px;
    }
    .info-logo {
      margin-bottom: 1.6rem;
      display: flex;
      align-items: center;
      gap: 0.7rem;
    }
    .info-logo img {
      width: 54px;
      height: 54px;
      border-radius: 10px;
      background: #fff;
      border: 2.5px solid var(--primary);
      object-fit: contain;
    }
    .info-logo span {
      font-weight: 700;
      font-size: 1.17rem;
      color: var(--primary);
      letter-spacing: 0.01em;
    }
    .info-highlights {
      margin-bottom: 2rem;
      font-size: 1.09rem;
    }
    .info-highlights strong {
      color: var(--primary);
      font-weight: 700;
    }
    .whatsapp-link {
      display: inline-flex;
      align-items: center;
      gap: 0.55em;
      background: var(--wa);
      color: #fff;
      border-radius: var(--radius);
      padding: 0.60em 1.1em;
      font-weight: 600;
      text-decoration: none;
      font-size: 1.07rem;
      margin-top: 1.0em;
      transition: background .15s;
      box-shadow: 0 1px 6px rgba(37,211,102,0.12);
      border: none;
      cursor: pointer;
    }
    .whatsapp-link svg {
      width: 1.38em;
      height: 1.38em;
      display: inline-block;
      vertical-align: middle;
      fill: currentColor;
    }
    .form-section {
      background: #fff;
      flex: 2 1 420px;
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 2.1rem 1.7rem 1.5rem 1.7rem;
      min-width: 290px;
      max-width: 480px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 1.2em;
      width: 100%;
    }
    .field-group {
      display: flex;
      flex-direction: column;
      gap: 0.2em;
      position: relative;
    }
    label {
      font-weight: 500;
      font-size: 1.04rem;
      color: #222;
      margin-bottom: 0.2em;
      letter-spacing: 0.01em;
    }
    input[type="text"], input[type="number"], input[type="date"], select {
      padding: 0.63em 0.95em;
      font-size: 1.08rem;
      border: 1.5px solid var(--border);
      border-radius: var(--radius);
      background: #fafbfc;
      font-family: 'Inter', Arial, sans-serif;
      color: #212121;
      margin-bottom: 0;
      transition: border-color .15s, box-shadow .15s;
    }
    input[type="text"]:focus, input[type="number"]:focus, input[type="date"]:focus, select:focus {
      border-color: var(--primary-light);
      outline: none;
      background: #fff;
      box-shadow: 0 0 0 2px var(--focus);
    }
    .field-error {
      font-size: 0.98em;
      color: var(--error);
      margin-top: 0.15em;
      font-weight: 500;
      min-height: 1.2em;
    }
    .field-radio {
      display: flex;
      gap: 1.6em;
      align-items: center;
    }
    .field-radio label {
      font-weight: 400;
      margin: 0 0 0 0.3em;
      font-size: 1.01em;
      color: #444;
    }
    .checkbox-group {
      display: flex;
      align-items: flex-start;
      gap: 0.7em;
      margin-top: 0.2em;
    }
    .checkbox-group input[type="checkbox"] {
      margin-top: 0.18em;
      transform: scale(1.17);
      accent-color: var(--primary);
    }
    .checkbox-group label {
      font-size: 0.99rem;
      font-weight: 400;
      color: #333;
      margin: 0;
      cursor: pointer;
    }
    .submit-btn {
      background: var(--primary);
      color: #fff;
      font-weight: 700;
      font-size: 1.14rem;
      border: none;
      border-radius: var(--radius);
      padding: 0.92em 1.6em;
      cursor: pointer;
      margin-top: 0.7em;
      transition: background 0.13s;
      letter-spacing: 0.01em;
      box-shadow: 0 2px 8px rgba(163,22,29,0.09);
    }
    .submit-btn:disabled {
      background: #b8b8b8;
      color: #fff;
      cursor: not-allowed;
      opacity: 0.63;
    }
    .note-info {
      margin-top: 1.08em;
      font-size: 0.97em;
      color: #555;
      opacity: 0.87;
      text-align: left;
    }
    .temp-warning {
      margin: 1.2em 0 0.2em 0;
      background: #fff1f1;
      border: 1.5px solid #ffeaea;
      color: var(--primary);
      font-size: 1.01rem;
      border-radius: var(--radius);
      padding: 0.85em 1.2em;
    }

    /* MODAL CUPOM */
    .coupon-modal-bg {
      position: fixed;
      z-index: 99;
      left: 0; top: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(33,33,33,0.21);
      display: flex;
      justify-content: center;
      align-items: center;
      transition: opacity .15s;
    }
    .coupon-modal {
      background: transparent;
      border-radius: 18px;
      box-shadow: none;
      padding: 0;
      max-width: 100vw;
      width: auto;
      text-align: center;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5em;
    }
    .coupon-modal .close-btn {
      position: absolute;
      top: -12px;
      right: -10px;
      background: var(--primary);
      color: #fff;
      font-size: 1.45rem;
      border: none;
      border-radius: 50%;
      width: 2.1em;
      height: 2.1em;
      cursor: pointer;
      line-height: 1;
      box-shadow: 0 2px 8px rgba(163,22,29,0.07);
      z-index: 2;
      transition: filter .13s;
    }
    .coupon-modal .close-btn:focus {
      outline: 2px solid var(--primary);
      filter: brightness(0.95);
    }
    .coupon-title {
      font-size: 1.13rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.1em;
      margin-top: 0.2em;
      letter-spacing: 0.01em;
      text-align: center;
    }
    /* CARTÃO CUPOM VISUAL */
    .coupon-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.7em;
      margin: 0.6em 0 0.6em 0;
      background: #fff;
      border-radius: 18px;
      border: 2.7px solid var(--primary);
      box-shadow: 0 6px 36px 0 rgba(163,22,29,0.13), 0 1.5px 9px 0 rgba(163,22,29,0.04);
      padding: 1.5em 1.2em 1.1em 1.2em;
      min-width: 0;
      width: 325px;
      max-width: 98vw;
      position: relative;
      overflow: visible;
      transition: box-shadow .17s;
    }
    @media (max-width: 480px) {
      .coupon-card { width: 97vw; min-width: 0; max-width: 98vw; }
    }
    .coupon-logo {
      width: 48px; height:48px;
      border-radius: 12px;
      object-fit: contain;
      margin-bottom: 0.1em;
      border: 2px solid #eee;
      background: #fff;
      box-shadow: 0 1.5px 7px 0 rgba(163,22,29,0.08);
    }
    .coupon-code-group {
      display: flex;
      align-items: center;
      gap: 0.6em;
      justify-content: center;
    }
    .coupon-code {
      font-family: 'Roboto Mono', 'Menlo', 'Consolas', monospace;
      font-size: 2.06rem;
      letter-spacing: 0.18em;
      font-weight: 800;
      color: var(--primary);
      background: #fafbfc;
      padding: 0.25em 1.09em;
      border-radius: 10px;
      border: 2.2px dashed var(--primary-light);
      text-align: center;
      user-select: all;
      margin-bottom: 2px;
      box-shadow: 0 1.5px 10px 0 rgba(163,22,29,0.07);
      min-width: 0;
    }
    .badge {
      display: inline-block;
      background: var(--badge);
      color: var(--badge-text);
      font-size: 1.14rem;
      font-weight: 700;
      border-radius: 13px;
      padding: 0.36em 1.18em;
      margin-left: 0.2em;
      vertical-align: middle;
      letter-spacing: 0.03em;
      box-shadow: 0 2px 6px rgba(163,22,29,0.13);
      border: 1.5px solid #fff;
      position: relative;
      top: 2px;
    }
    .coupon-details {
      font-size: 1.02em;
      color: #444;
      margin-bottom: 0.1em;
      margin-top: 0.0em;
      line-height: 1.45;
      font-weight: 500;
    }
    .coupon-validity {
      font-size: 1.06em;
      color: #555;
      margin-bottom: 0.3em;
      margin-top: -0.34em;
    }
    .coupon-actions {
      display: flex;
      justify-content: center;
      gap: 0.8em;
      flex-wrap: wrap;
      margin-top: 0.4em;
      margin-bottom: 0.2em;
      width: 100%;
    }
    .copy-btn, .copy-img-btn {
      background: #fafafa;
      border: 1.8px solid var(--primary-light);
      color: var(--primary);
      font-size: 1.09rem;
      border-radius: var(--radius);
      padding: 0.54em 1.00em;
      font-weight: 700;
      cursor: pointer;
      transition: background .12s, color .12s;
      display: flex;
      align-items: center;
      gap: 0.37em;
      box-shadow: 0 2px 10px 0 rgba(33,33,33,0.07);
    }
    .copy-btn.copied, .copy-btn:active,
    .copy-img-btn.copied, .copy-img-btn:active {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
    }
    .coupon-actions .whatsapp-link {
      font-size: 1.07rem;
      padding: 0.5em 1.2em;
      margin-top: 0;
    }
    .coupon-note {
      font-size: 0.96em;
      color: #7b2124;
      margin-top: 0.5em;
      opacity: 0.91;
      text-align: center;
      line-height: 1.37;
      font-weight: 500;
    }
    @media (max-width: 960px) {
      main { flex-direction: column; align-items: stretch; gap: 2.6rem; padding: 2rem 0.7rem 1.2rem 0.7rem;}
      .info {margin-right: 0; max-width: 100vw; margin-bottom: -0.9em;}
      .form-section {max-width: 100vw;}
    }
    @media (max-width: 600px) {
      main {padding: 1.1rem 0.1rem 2.2rem 0.1rem; gap: 1.1rem;}
      header {font-size: 1rem; padding: 1.1rem 0 0.9rem 0;}
      .info-logo img { width: 43px; height: 43px; }
      .info-logo span { font-size: 1.01rem; }
      .form-section { padding: 1.2rem 0.7rem 1.1rem 0.7rem; min-width: unset;}
      .coupon-modal {padding: 0;}
      .coupon-card {width: 98vw; min-width: 0; max-width: 99vw;}
      .coupon-logo {width: 36px; height: 36px;}
      .coupon-code {font-size: 1.16rem; padding: 0.38em 0.8em;}
    }
  </style>
</head>
<body>
  <header>
    <h1>Instituto Mix — Campo Largo | Solicite sua Bolsa de Desconto</h1>
    <p>Preencha os dados abaixo e gere seu cupom de até 35% para o curso desejado.</p>
  </header>
  <main>
    <aside class="info" aria-label="Sobre o Instituto Mix">
      <div class="info-logo">
        <img src="favicon.png" alt="Logo Instituto Mix" />
        <span>Instituto Mix<br>Campo Largo</span>
      </div>
      <div class="info-highlights">
        <ul style="padding-left: 1.1em; margin:0; list-style: disc;">
          <li>Descontos especiais <strong>de até 35%</strong> para novos alunos</li>
          <li>Válido em cursos presenciais e técnicos</li>
          <li>Atendimento presencial ou online</li>
        </ul>
      </div>
      <a class="whatsapp-link" href="https://wa.me/5541991487704?text=Ol%C3%A1%2C%20gostaria%20de%20validar%20meu%20cupom" 
         target="_blank" rel="noopener" aria-label="Fale com um Consultor via WhatsApp">
        <svg aria-hidden="true" focusable="false" viewBox="0 0 32 32"><path d="M16 3C9.373 3 4 8.373 4 15c0 2.497.728 4.82 2.107 6.856L4 29l7.331-2.063A12.914 12.914 0 0 0 16 27c6.627 0 12-5.373 12-12S22.627 3 16 3zm0 22.667c-2.224 0-4.392-.657-6.241-1.898l-.446-.294-4.354 1.226 1.262-4.259-.29-.441C5.692 17.002 5 15.042 5 13c0-6.075 4.925-11 11-11s11 4.925 11 11-4.925 11-11 11zm6.048-9.39c-.332-.166-1.965-.971-2.27-1.087-.305-.116-.528-.166-.75.167-.222.333-.86 1.088-1.055 1.312-.195.222-.389.25-.721.083-.333-.167-1.408-.518-2.682-1.647-.992-.884-1.663-1.977-1.86-2.31-.195-.333-.021-.513.146-.68.15-.15.333-.389.5-.583.167-.195.222-.333.333-.555.111-.222.056-.416-.028-.583-.083-.166-.75-1.812-1.028-2.486-.271-.651-.547-.563-.75-.573-.194-.01-.417-.012-.641-.012-.222 0-.583.083-.889.389C8.55 8.246 8 9.268 8 10.043c0 .776.236 1.525.389 1.74.149.222.333.541.556.864.223.323 2.303 3.327 5.583 4.539.78.301 1.387.48 1.86.613.778.215 1.487.185 2.048.112.625-.083 1.965-.8 2.245-1.572.278-.77.278-1.428.195-1.572-.083-.143-.307-.23-.64-.396z"/></svg>
        Fale com Consultor (WhatsApp)
      </a>
      <div class="note-info" style="margin-top: 1.7em;">
        <b>Dúvidas?</b> Consulte condições, documentos e horários com nosso time pelo WhatsApp ou presencialmente.
      </div>
<section class="testimonials" aria-labelledby="testimonialsTitle">
  <h2 id="testimonialsTitle" style="font-size:1.12em;margin-top:1.8em;margin-bottom:0.6em;">Depoimentos</h2>
  <blockquote>
    <p>O Instituto Mix mudou minha vida! Os cursos são incríveis!</p>
    <footer>— Aluna A</footer>
  </blockquote>
  <blockquote>
    <p>Ótima experiência e aprendizado!</p>
    <footer>— Aluno B</footer>
  </blockquote>
</section>

<section class="faq" aria-labelledby="faqTitle">
  <h2 id="faqTitle" style="font-size:1.12em;margin-top:1.8em;margin-bottom:0.6em;">Perguntas Frequentes</h2>
  <dl>
    <dt><strong>Como posso validar meu cupom?</strong></dt>
    <dd>Apresente o cupom no momento da matrícula e confirme as condições com o Consultor.</dd>
    <dt><strong>Qual é a validade do cupom?</strong></dt>
    <dd>O cupom é válido apenas para novos alunos e para cursos presenciais e técnicos.</dd>
  </dl>
</section>
    </aside>
    <section class="form-section" aria-label="Formulário de solicitação de cupom">
      <form id="couponForm" autocomplete="off" novalidate aria-labelledby="formTitle">
        <div class="field-group">
          <label for="nomeCompleto">Nome completo *</label>
          <input type="text" id="nomeCompleto" name="nomeCompleto" required autocomplete="name" maxlength="80" aria-required="true" aria-describedby="nomeCompletoHelp"/>
          <div class="field-error" id="nomeCompletoError"></div>
        </div>
        <div class="field-group">
          <label for="dataNascimento">Data de nascimento *</label>
          <input type="text" inputmode="numeric" pattern="\d{2}/\d{2}/\d{4}" id="dataNascimento" name="dataNascimento" required maxlength="10" placeholder="DD/MM/AAAA" aria-required="true"/>
          <div class="field-error" id="dataNascimentoError"></div>
        </div>
        <div class="field-group">
          <label for="cursoDesejado">Curso desejado *</label>
          <select id="cursoDesejado" name="cursoDesejado" required aria-required="true"></select>
          <div class="field-error" id="cursoDesejadoError"></div>
        </div>
        <div class="field-group">
          <div class="field-group">
  <label for="turno">Turno *</label>
  <select id="turno" name="turno" required>
    <option value="">Selecione...</option>
    <option value="manhã">Manhã</option>
    <option value="tarde">Tarde</option>
    <option value="noite">Noite</option>
  </select>
  <div class="field-error" id="turnoError"></div>
</div>
        <div class="field-group">
          <label for="bairro">Bairro *</label>
          <input type="text" id="bairro" name="bairro" required maxlength="50" aria-required="true"/>
          <div class="field-error" id="bairroError"></div>
        </div>
        <div class="field-group">
          <label for="moradores">Quantas pessoas moram na sua casa? *</label>
          <input type="number" id="moradores" name="moradores" required min="1" max="20" step="1" aria-required="true"/>
          <div class="field-error" id="moradoresError"></div>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="consentimento" name="consentimento" required aria-required="true"/>
          <label for="consentimento">Autorizo contato por WhatsApp e confirmo que as informações são verdadeiras.</label>
        </div>
        <div class="field-error" id="consentimentoError"></div>
        <button type="submit" class="submit-btn" id="submitBtn">GERAR MEU CUPOM</button>
        <div class="note-info" style="margin-top:0.7em;">Cada pessoa pode gerar apenas 1 cupom. Em caso de dúvidas, fale conosco.</div>
        <div id="tempWarning" class="temp-warning" style="display:none;"></div>
      </form>
    </section>
  </main>

  <!-- Cupom Modal -->
  <div id="couponModalBg" class="coupon-modal-bg" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="coupon-modal">
      <button class="close-btn" id="closeModalBtn" aria-label="Fechar modal">&times;</button>
      <div class="coupon-title" id="modalTitle"></div>
      <div class="coupon-card" id="visualCupom">
        <img class="coupon-logo" src="favicon.png" alt="Logo Instituto Mix"/>
        <div class="coupon-code-group">
          <span class="coupon-code" id="modalCouponCode">CODE123</span>
          <span class="badge">ATÉ 35%</span>
        </div>
        <div class="coupon-details" id="modalCouponDetails">
          <!-- preenchido via JS -->
        </div>
        <div class="coupon-validity" id="modalCouponValidity"></div>
        <div class="coupon-note">
          Apresente esse cupom no momento da matrícula e confirme as condições com o Consultor.<br/>
          <span style="display:block;margin-top:0.4em;font-size:0.94em;">Valide seu cupom com um Consultor para confirmar sua bolsa.</span>
        </div>
      </div>
      <div class="coupon-actions">
        <button class="copy-btn" id="copyCouponBtn" type="button" aria-label="Copiar código do cupom">
          <svg aria-hidden="true" viewBox="0 0 24 24" style="width:1.15em; height:1.15em; fill:currentColor;"><path d="M16 1H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h2v2a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7zm-2 2v4a2 2 0 0 0 2 2h4v10a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1zm2 0l6 6"/></svg>
          Copiar Código
        </button>
        <button class="copy-img-btn" id="copyCupomImgBtn" type="button" aria-label="Copiar imagem do cupom">
          <svg aria-hidden="true" viewBox="0 0 24 24" style="width:1.13em; height:1.13em; fill:currentColor;">
            <path d="M21 19V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2ZM5 5h14v5.17l-2.59-2.58a2 2 0 0 0-2.83 0l-6.59 6.59V5Zm0 14v-2.17l6.59-6.59a2 2 0 0 1 2.83 0l2.58 2.58V19H5Z"/>
          </svg>
          Copiar Cupom (Imagem)
        </button>
        <a class="whatsapp-link" id="modalWAButton" href="#" target="_blank" rel="noopener">
          <svg aria-hidden="true" focusable="false" viewBox="0 0 32 32"><path d="M16 3C9.373 3 4 8.373 4 15c0 2.497.728 4.82 2.107 6.856L4 29l7.331-2.063A12.914 12.914 0 0 0 16 27c6.627 0 12-5.373 12-12S22.627 3 16 3zm0 22.667c-2.224 0-4.392-.657-6.241-1.898l-.446-.294-4.354 1.226 1.262-4.259-.29-.441C5.692 17.002 5 15.042 5 13c0-6.075 4.925-11 11-11s11 4.925 11 11-4.925 11-11 11zm6.048-9.39c-.332-.166-1.965-.971-2.27-1.087-.305-.116-.528-.166-.75.167-.222.333-.86 1.088-1.055 1.312-.195.222-.389.25-.721.083-.333-.167-1.408-.518-2.682-1.647-.992-.884-1.663-1.977-1.86-2.31-.195-.333-.021-.513.146-.68.15-.15.333-.389.5-.583.167-.195.222-.333.333-.555.111-.222.056-.416-.028-.583-.083-.166-.75-1.812-1.028-2.486-.271-.651-.547-.563-.75-.573-.194-.01-.417-.012-.641-.012-.222 0-.583.083-.889.389C8.55 8.246 8 9.268 8 10.043c0 .776.236 1.525.389 1.74.149.222.333.541.556.864.223.323 2.303 3.327 5.583 4.539.78.301 1.387.48 1.86.613.778.215 1.487.185 2.048.112.625-.083 1.965-.8 2.245-1.572.278-.77.278-1.428.195-1.572-.083-.143-.307-.23-.64-.396z"/></svg>
          Validar com Consultor (WhatsApp)
        </a>
      </div>
    </div>
  </div>

  <script>
    // === CONFIGURAÇÕES GERAIS ===
    // Lista de cursos (pode ser substituída por fetch/carga dinâmica)
    const cursosDisponiveis = [
      "Barbeiro Profissional",
      "Manicure e Pedicure",
      "Cabeleireiro(a)",
      "Técnico em Enfermagem",
      "Design de Sobrancelhas",
      "Maquiagem Profissional",
      "Estética Facial e Corporal",
      "Auxiliar Administrativo",
      "Inglês",
      "Informática Completa"
    ];
    const CUPOM_VALIDADE_DIAS = 7;
    const CUPOM_DESCONTO_DISPLAY = "ATÉ 35%";
    const WHATSAPP_NUMERO = "5541991487704";
    function gerarMsgWA(nome, code) {
      return `Olá, tenho um cupom para validar - Nome: ${nome} - Cupom: ${code}`;
    }
    const API_BASE = "";
    const LOCAL_STORAGE_KEY = "imix_cupom_cl";
    function normalizarNome(nome) {
      return nome
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .replace(/\s+/g, " ")
        .trim()
        .toLowerCase();
    }
    function validarDataNascimento(dn) {
      const match = dn.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);
      if (!match) return false;
      const [_, dia, mes, ano] = match;
      const dt = new Date(`${ano}-${mes}-${dia}`);
      if (isNaN(dt.getTime())) return false;
      // idade mínima
      // const hoje = new Date();
      // let idade = hoje.getFullYear() - dt.getFullYear();
      // if (
      //   hoje.getMonth() < dt.getMonth() ||
      //   (hoje.getMonth() === dt.getMonth() && hoje.getDate() < dt.getDate())
      // ) idade--;
      // if (idade < 14) return "Idade mínima é 14 anos";
      return true;
    }
    function gerarCupomCode() {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
      let out = "";
      for (let i=0; i<6; i++) out += chars.charAt(Math.floor(Math.random()*chars.length));
      return out;
    }
    function validadeCupom(createdAt) {
      const data = new Date(createdAt);
      data.setDate(data.getDate() + CUPOM_VALIDADE_DIAS);
      const d = String(data.getDate()).padStart(2,"0");
      const m = String(data.getMonth()+1).padStart(2,"0");
      const y = data.getFullYear();
      return `${d}/${m}/${y}`;
    }
    function safeText(txt) {
      return String(txt).replace(/[<>]/g,"").trim();
    }
    function trackEvent(evt, props={}) {
      if (window.gtag) window.gtag("event", evt, props);
    }
    const cursoSelect = document.getElementById("cursoDesejado");
    function carregarCursos() {
      cursoSelect.innerHTML = '<option value="">Selecione...</option>' +
        cursosDisponiveis.map(c =>
          `<option value="${safeText(c)}">${c}</option>`
        ).join("");
    }
    carregarCursos();

    // === FORMULÁRIO E SUBMISSÃO ===
    const form = document.getElementById("couponForm");
    const submitBtn = document.getElementById("submitBtn");
    const tempWarning = document.getElementById("tempWarning");
    let bloqueado = false;
    function erro(id, msg) {
      document.getElementById(id).innerText = msg || "";
    }
    function limparErros() {
      ["nomeCompletoError","dataNascimentoError","cursoDesejadoError","turnoError","bairroError","moradoresError","consentimentoError"].forEach(id => erro(id,""));
    }
    function validarCampos(dados) {
      limparErros();
      let ok = true;
      if (!dados.nomeCompleto || dados.nomeCompleto.length < 5) {
        erro("nomeCompletoError", "Informe seu nome completo.");
        ok = false;
      }
      if (!dados.dataNascimento || !validarDataNascimento(dados.dataNascimento)) {
        erro("dataNascimentoError", "Data no formato DD/MM/AAAA.");
        ok = false;
      }
      if (!dados.cursoDesejado) {
        erro("cursoDesejadoError", "Selecione um curso.");
        ok = false;
      }
      if (!dados.turno) {
        erro("turnoError", "Escolha um turno.");
        ok = false;
      }
      if (!dados.bairro || dados.bairro.length < 3) {
        erro("bairroError", "Informe o bairro.");
        ok = false;
      }
      if (!dados.moradores || isNaN(dados.moradores) || +dados.moradores < 1) {
        erro("moradoresError", "Informe um número válido.");
        ok = false;
      }
      if (!dados.consentimento) {
        erro("consentimentoError", "Confirme o consentimento.");
        ok = false;
      }
      return ok;
    }
    async function buscarCupom(nomeNorm, dataNasc) {
      if (API_BASE) {
        const params = new URLSearchParams({ name: nomeNorm, dob: dataNasc });
        const res = await fetch(`${API_BASE}/api/coupons?${params.toString()}`);
        if (res.ok) return await res.json();
        return null;
      } else {
        const all = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY) || "[]");
        return all.find(c =>
          c.nome_normalizado === nomeNorm &&
          c.data_nascimento === dataNasc
        ) || null;
      }
    }
    async function criarCupom(dados) {
      if (API_BASE) {
        const res = await fetch(`${API_BASE}/api/coupons`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(dados)
        });
        if (!res.ok) throw new Error("Erro ao gerar cupom.");
        return await res.json();
      } else {
        let all = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY) || "[]");
        if (all.some(c =>
          c.nome_normalizado === dados.nome_normalizado &&
          c.data_nascimento === dados.data_nascimento
        )) {
          throw new Error("DUPLICADO");
        }
        const createdAt = new Date().toISOString();
        const novo = {
          ...dados,
          coupon_code: dados.coupon_code,
          created_at: createdAt,
          discount_percent: 35
        };
        all.push(novo);
        localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(all));
        return novo;
      }
    }
    form.addEventListener("submit", async function(ev) {
      ev.preventDefault();
      if (bloqueado) return;
      submitBtn.disabled = true;
      submitBtn.innerText = "Gerando...";
      tempWarning.style.display = "none";
      bloqueado = true;
      const nomeCompleto = safeText(form.nomeCompleto.value);
      const dataNascimento = safeText(form.dataNascimento.value);
      const cursoDesejado = safeText(form.cursoDesejado.value);
      const turno = form.turno.value;
      const bairro = safeText(form.bairro.value);
      const moradores = parseInt(form.moradores.value, 10);
      const consentimento = form.consentimento.checked;
      const nome_normalizado = normalizarNome(nomeCompleto);
      const dados = {
        nome: nomeCompleto,
        nome_normalizado: nome_normalizado,
        data_nascimento: dataNascimento,
        curso: cursoDesejado,
        turno: turno,
        bairro: bairro,
        moradores: moradores,
        coupon_code: gerarCupomCode(),
        discount_percent: 35
      };
      if (!validarCampos({
        nomeCompleto, dataNascimento, cursoDesejado, turno, bairro, moradores, consentimento
      })) {
        submitBtn.disabled = false;
        submitBtn.innerText = "GERAR MEU CUPOM";
        bloqueado = false;
        return;
      }
      try {
        const existente = await buscarCupom(nome_normalizado, dataNascimento);
        if (existente) {
          abrirModalCupom({
            ...existente,
            nome: nomeCompleto
          }, true);
          submitBtn.disabled = false;
          submitBtn.innerText = "GERAR MEU CUPOM";
          bloqueado = false;
          return;
        }
        dados.created_at = new Date().toISOString();
        const novo = await criarCupom(dados);
        abrirModalCupom({
          ...novo,
          nome: nomeCompleto
        }, false);
        if (!API_BASE) {
          tempWarning.innerText = "Solução temporária: cupom salvo apenas neste dispositivo. Para garantia, entre em contato com o Consultor.";
          tempWarning.style.display = "block";
        }
        trackEvent("coupon_generated", { nome: dados.nome, curso: dados.curso });
      } catch (e) {
        if (e.message === "DUPLICADO") {
          abrirModalCupom(await buscarCupom(nome_normalizado, dataNascimento), true);
        } else {
          alert("Erro ao gerar cupom. Tente novamente em instantes.");
        }
      }
      submitBtn.disabled = false;
      submitBtn.innerText = "GERAR MEU CUPOM";
      bloqueado = false;
    });

    // === MODAL DE CUPOM ===
    const couponModalBg = document.getElementById("couponModalBg");
    const closeModalBtn = document.getElementById("closeModalBtn");
    const modalTitle = document.getElementById("modalTitle");
    const modalCouponCode = document.getElementById("modalCouponCode");
    const modalCouponDetails = document.getElementById("modalCouponDetails");
    const modalCouponValidity = document.getElementById("modalCouponValidity");
    const copyCouponBtn = document.getElementById("copyCouponBtn");
    const copyCupomImgBtn = document.getElementById("copyCupomImgBtn");
    const modalWAButton = document.getElementById("modalWAButton");
    const visualCupom = document.getElementById("visualCupom");

    let currentCupomInfo = {};
    function abrirModalCupom(cupom, jaExistente) {
      couponModalBg.style.display = "flex";
      document.body.style.overflow = "hidden";
      modalTitle.innerText = jaExistente
        ? "Já existe um cupom gerado para este nome."
        : `Parabéns, ${cupom.nome.split(" ")[0]}!`;
      modalCouponCode.innerText = cupom.coupon_code;
      modalCouponDetails.innerHTML = jaExistente
        ? `Entre em contato com um Consultor via WhatsApp para validar ou recuperar seu cupom.`
        : `Seu cupom: <b>${cupom.coupon_code}</b> — <span class="badge">${CUPOM_DESCONTO_DISPLAY}</span>.<br>Valide esse cupom com um de nossos Consultores antes da matrícula.`;
      modalCouponValidity.innerText = `Validade: até ${validadeCupom(cupom.created_at)}`;
      modalWAButton.href = `https://wa.me/${WHATSAPP_NUMERO}?text=${encodeURIComponent(gerarMsgWA(cupom.nome, cupom.coupon_code))}`;
      copyCouponBtn.classList.remove("copied");
      copyCouponBtn.innerHTML = `<svg aria-hidden="true" viewBox="0 0 24 24" style="width:1.15em; height:1.15em; fill:currentColor;"><path d="M16 1H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h2v2a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7zm-2 2v4a2 2 0 0 0 2 2h4v10a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1zm2 0l6 6"/></svg> Copiar Código`;
      copyCupomImgBtn.classList.remove("copied");
      copyCupomImgBtn.innerHTML = `<svg aria-hidden="true" viewBox="0 0 24 24" style="width:1.13em; height:1.13em; fill:currentColor;">
            <path d="M21 19V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2ZM5 5h14v5.17l-2.59-2.58a2 2 0 0 0-2.83 0l-6.59 6.59V5Zm0 14v-2.17l6.59-6.59a2 2 0 0 1 2.83 0l2.58 2.58V19H5Z"/>
          </svg> Copiar Cupom (Imagem)`;
      currentCupomInfo = {
        code: cupom.coupon_code,
        validade: validadeCupom(cupom.created_at),
        nome: cupom.nome,
        selo: CUPOM_DESCONTO_DISPLAY,
        logo: visualCupom.querySelector('.coupon-logo').src
      };
      setTimeout(() => {
        couponModalBg.querySelector('.coupon-modal').focus();
      }, 100);
    }
    function fecharModal() {
      couponModalBg.style.display = "none";
      document.body.style.overflow = "";
    }
    closeModalBtn.onclick = fecharModal;
    couponModalBg.addEventListener("click", function(ev) {
      if (ev.target === couponModalBg) fecharModal();
    });
    document.addEventListener("keydown", function(ev) {
      if (couponModalBg.style.display !== "none" && (ev.key === "Escape" || ev.key === "Esc")) fecharModal();
    });

    // Copiar código texto
    copyCouponBtn.onclick = function() {
      const code = modalCouponCode.innerText;
      navigator.clipboard.writeText(code).then(() => {
        copyCouponBtn.classList.add("copied");
        copyCouponBtn.innerHTML = `<svg aria-hidden="true" viewBox="0 0 24 24" style="width:1.13em; height:1.13em; fill:currentColor;">
        <path d="M9.29 16.29a1 1 0 0 0 1.42 1.42l6-6a1 1 0 0 0-1.42-1.42L10 14.17l-2.29-2.3a1 1 0 0 0-1.42 1.42z"/></svg> Copiado!`;
        setTimeout(() => {
          copyCouponBtn.classList.remove("copied");
          copyCouponBtn.innerHTML = `<svg aria-hidden="true" viewBox="0 0 24 24" style="width:1.15em; height:1.15em; fill:currentColor;"><path d="M16 1H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h2v2a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7zm-2 2v4a2 2 0 0 0 2 2h4v10a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1zm2 0l6 6"/></svg> Copiar Código`;
        }, 2000);
      });
    };

    // Copiar imagem do cupom
    copyCupomImgBtn.onclick = async function() {
      copyCupomImgBtn.disabled = true;
      copyCupomImgBtn.innerText = "Gerando imagem...";
      try {
        const img = await gerarImagemCupom(currentCupomInfo);
        if (navigator.clipboard && window.ClipboardItem) {
          await navigator.clipboard.write([
            new ClipboardItem({ "image/png": img })
          ]);
          copyCupomImgBtn.classList.add("copied");
          copyCupomImgBtn.innerHTML = `<svg aria-hidden="true" viewBox="0 0 24 24" style="width:1.13em; height:1.13em; fill:currentColor;">
              <path d="M21 19V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2ZM5 5h14v5.17l-2.59-2.58a2 2 0 0 0-2.83 0l-6.59 6.59V5Zm0 14v-2.17l6.59-6.59a2 2 0 0 1 2.83 0l2.58 2.58V19H5Z"/>
            </svg> Imagem copiada!`;
          setTimeout(() => {
            copyCupomImgBtn.classList.remove("copied");
            copyCupomImgBtn.innerHTML = `<svg aria-hidden="true" viewBox="0 0 24 24" style="width:1.13em; height:1.13em; fill:currentColor;">
              <path d="M21 19V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2ZM5 5h14v5.17l-2.59-2.58a2 2 0 0 0-2.83 0l-6.59 6.59V5Zm0 14v-2.17l6.59-6.59a2 2 0 0 1 2.83 0l2.58 2.58V19H5Z"/>
            </svg> Copiar Cupom (Imagem)`;
          }, 2300);
        } else {
          alert("Seu navegador não suporta cópia de imagem para a área de transferência. Use a opção de copiar código.");
        }
      } catch (e) {
        alert("Erro ao gerar imagem do cupom.");
      }
      copyCupomImgBtn.disabled = false;
      copyCupomImgBtn.innerHTML = `<svg aria-hidden="true" viewBox="0 0 24 24" style="width:1.13em; height:1.13em; fill:currentColor;">
              <path d="M21 19V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2ZM5 5h14v5.17l-2.59-2.58a2 2 0 0 0-2.83 0l-6.59 6.59V5Zm0 14v-2.17l6.59-6.59a2 2 0 0 1 2.83 0l2.58 2.58V19H5Z"/>
            </svg> Copiar Cupom (Imagem)`;
    };

    // Gera imagem PNG do cartão do cupom usando Canvas API
    async function gerarImagemCupom({code, validade, nome, selo, logo}) {
      const largura = 340, altura = 270;
      const c = document.createElement('canvas');
      c.width = largura; c.height = altura;
      const ctx = c.getContext('2d');
      // Fundo
      ctx.fillStyle = "#fff";
      ctx.fillRect(0,0, largura, altura);
      // Sombra
      ctx.save();
      ctx.shadowColor = "#a3161d44";
      ctx.shadowBlur = 16;
      ctx.fillRect(10,10, largura-20, altura-20);
      ctx.restore();
      // Borda
      ctx.strokeStyle = "#a3161d";
      ctx.lineWidth = 4.2;
      ctx.strokeRect(12,12, largura-24, altura-24);

      // Logo
      const logoImg = await carregarImagem(logo);
      ctx.save();
      ctx.beginPath();
      ctx.arc(42, 52, 24, 0, 2*Math.PI);
      ctx.closePath();
      ctx.clip();
      ctx.drawImage(logoImg, 18, 29, 48, 48);
      ctx.restore();

      // Título
      ctx.font = "600 1.09rem Inter,Arial";
      ctx.fillStyle = "#a3161d";
      ctx.textAlign = "left";
      ctx.fillText("Instituto Mix Campo Largo", 74, 56);
      ctx.font = "400 0.95rem Inter,Arial";
      ctx.fillStyle = "#333";
      ctx.fillText("Cupom de desconto", 74, 74);

      // Código cupom
      ctx.font = "bold 2.05rem 'Roboto Mono',monospace";
      ctx.textAlign = "center";
      ctx.fillStyle = "#a3161d";
      ctx.fillRect(32, 92, largura-64, 56);
      ctx.fillStyle = "#fff";
      ctx.fillText(code, largura/2, 128);

      // Badge/selo
      ctx.save();
      ctx.beginPath();
      ctx.roundRect(largura-110, 92, 74, 34, 14);
      ctx.closePath();
      ctx.fillStyle = "#a3161d";
      ctx.fill();
      ctx.font = "700 1.08rem Inter";
      ctx.fillStyle = "#fff";
      ctx.textAlign = "center";
      ctx.fillText(selo, largura-72, 116);
      ctx.restore();

      // Validade
      ctx.font = "500 1rem Inter";
      ctx.fillStyle = "#a3161d";
      ctx.textAlign = "center";
      ctx.fillText(`Validade até ${validade}`, largura/2, 156);

      // Observação
      ctx.font = "400 0.97rem Inter";
      ctx.fillStyle = "#7b2124";
      ctx.textAlign = "center";
      ctx.fillText("Apresente este cupom ao Consultor", largura/2, 186);
      ctx.font = "400 0.93rem Inter";
      ctx.fillText("antes da matrícula para garantir sua bolsa.", largura/2, 202);

      // Nome
      ctx.font = "400 0.93rem Inter";
      ctx.fillStyle = "#333";
      ctx.fillText(`Nome: ${nome}`, largura/2, 232);

      return new Promise(res=>{
        c.toBlob(blob=>res(blob),"image/png");
      });
    }
    function carregarImagem(src) {
      return new Promise((resolve, reject) => {
        const img = new window.Image();
        img.crossOrigin = "anonymous";
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = src;
      });
    }

    // Acessibilidade: foco inicial no form
    window.addEventListener("DOMContentLoaded", function(){
      form.nomeCompleto.focus();
    });

    // Input máscara data
    form.dataNascimento.addEventListener("input", function(ev){
      let v = this.value.replace(/\D/g,"").slice(0,8);
      if (v.length > 4) v = v.slice(0,2) + "/" + v.slice(2,4) + "/" + v.slice(4);
      else if (v.length > 2) v = v.slice(0,2) + "/" + v.slice(2);
      this.value = v;
    });

    // Rate limit básico
    let lastSubmit = 0;
    form.addEventListener("submit", function(ev){
      const now = Date.now();
      if (now - lastSubmit < 2500) {
        ev.preventDefault();
        return false;
      }
      lastSubmit = now;
    });

    // Teclado: Enter para copiar código
    copyCouponBtn.addEventListener("keydown", function(ev){
      if (ev.key === "Enter" || ev.key === " ") {
        ev.preventDefault();
        copyCouponBtn.click();
      }
    });

    // README PARA INTEGRAÇÃO (ver resposta anterior para detalhes)
  </script>
</body>
</html>



